<div class="h1 title-wrapper">
  <h1>{{ bookMeta.name }}</h1>
  <button *ngIf="showEditMeta()" mat-icon-button class="large" (click)="onInfo()"><mat-icon>info</mat-icon></button>
  <a *ngIf="showAuth()" mat-icon-button [routerLink]="'security'" class="large"><mat-icon>security</mat-icon></a>
  <button *ngIf="showUploadPage()" mat-icon-button class="large" (click)="onUpload(!showUpload)"><mat-icon class="toggle" [class.toggled]="showUpload">cloud_upload</mat-icon></button>
  <button mat-icon-button class="large" (click)="onDownloadAll()"><mat-icon>cloud_download</mat-icon></button>
  <a mat-icon-button class="large" [routerLink]="bookCommentsViewPath()"><mat-icon [matBadge]="(commentsCount | async).toString()" [matBadgeColor]="">comment</mat-icon></a>
</div>
<mat-toolbar class="light h5">
  <ng-container *ngIf="selectedPages.size > 0" class="light h5">
    Selection
    <app-hover-menu class="page-preview-buttons">
      <li mat-menu-item (click)="onSelectAll()"><mat-icon class="icon-selection-all"></mat-icon><button mat-button>Select all</button></li>
      <li mat-menu-item (click)="onClearSelection()"><mat-icon class="icon-selection-clear"></mat-icon><button mat-button>Clear selection</button></li>
      <li mat-menu-item *ngIf="showRenamePage()" (click)="onAutoRenamePages(selectedPages)"><mat-icon class="icon-edit-text"></mat-icon><button mat-button>Rename selected pages</button></li>
      <li mat-menu-item (click)="onDownload(selectedPages)"><mat-icon>cloud_download</mat-icon><button mat-button>Export</button></li>
      <li mat-menu-item *ngIf="showDeletePage()" (click)="onSelectionResetAnnotations()"><mat-icon class="icon-restore-page"></mat-icon><button mat-button color="warn">Reset annotations</button></li>
      <li mat-menu-item *ngIf="showDeletePage()" (click)="onSelectionRemovePages()"><mat-icon class="icon-delete-forever"></mat-icon><button mat-button color="warn">Delete</button></li>
    </app-hover-menu>
  </ng-container>
  <div class="spacer"></div>
  <mat-form-field>
    <mat-select [(value)]="selectedColor" (change)="setUnloaded()" class="form-control">
      <mat-option value="color">Color</mat-option>
      <mat-option value="gray">Gray</mat-option>
      <mat-option value="binary">Binary</mat-option>
    </mat-select>
  </mat-form-field>
  <mat-divider [vertical]="true"></mat-divider>
  <mat-form-field>
    <mat-select [(value)]="selectedProcessing" (change)="setUnloaded()" class="form-control">
      <mat-option value="original">Original</mat-option>
      <mat-option value="deskewed">Deskewed</mat-option>
      <!-- <option value="cropped">Cropped</option>
      <option value="detected_staffs">Detected Staffs</option> -->
    </mat-select>
  </mat-form-field>
</mat-toolbar>


<div *ngIf="showUpload">
  <app-page-uploader [book]="book" (uploadSuccess)="reload.emit()"></app-page-uploader>
</div>

<div #previewList class="preview-list">
  <div *ngFor="let page of pages"
       class="list-item"
       [class.selected]="selectedPages.has(page)"
       [class.focus]="page === currentPage"
       (click)="selectPage($event, page)"
       (dblclick)="editPage(page)"
       >
    <app-page-preview
      [page]="page"
      [color]="selectedColor"
      [processing]="selectedProcessing"
      [toolButtons]="true"
      [showDelete]="showDeletePage()"
      [showRename]="showRenamePage()"
      (edit)="editPage(page)"
      (remove)="removePage(page)"
      (rename)="renamePage(page)"
      (download)="onDownloadPage(page)"
    ></app-page-preview>
    <div class="selected-overlay" *ngIf="selectedPages.has(page)"></div>
  </div>
</div>
